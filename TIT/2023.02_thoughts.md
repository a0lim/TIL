## 2023.02.01
2월이다. 오늘은 기간손익 현황 서비스에 대해 더 자세하게 설계를 했다.  
어떤 table을 어떤 key 값으로 가져올 것인지, 순서는 어떻게 해야하는지 등을 우선으로 연결해보았다.  
연결할 table에는 관리항목도 있는데, 이 table은 기존에 연결된 적이 없어서 dummy data도 새로 만들고 문제가 없는지 테스트도 진행했다.
오늘은 관리항목을 연결하기 직전까지 쿼리를 작성했고, 이제 내일부터 관리항목과 연결하려고 한다.  
이 부분은 사용된 적이 없어서 개발이 완전히 끝나 있는지도 확인해야 한다.  
추가로, 현재 gitlab의 배포에 문제가 있어서 swagger을 돌려보지 못한다. 자바 버전을 11로 업데이트 했는데(개발 컨벤션 상의됨) 업데이트 이후에도 문제가 없는지 확인하기 위해서는 직접 spring code 작성은 삼가하려고 한다.  

## 2023.02.03
아직도 일은 쉽지 않다.  
요즘 현황 조회 쿼리를 작성하고 있었고 앞부분이 중복되는 두 개의 쿼리로 완성했다.(형태가 다름) 이 중복되는 부분을 하나로 처리하고 이어붙일수는 없을지 고민하던 찰나에, 이 고민이 내 담당이 아니라는 조언을 받았다.  
현황에서 필요한 데이터는 분개 관련해서 관리항목 등을 가져오는 건데 이 부분은 분개 담당자가 작성해야 하는 부분이라고 하셨다.  
처음 period_balance를 할 때 모르는 것이 많아서 질문을 참 많이 했는데, 그래서 이번에는 최대한 내 혼자 힘으로 해보려고 했었다.  
어디까지가 내가 해야하는 일이고, 어디까지가 다른 사람의 담당인지 아직은 잘 모르겠다.  
오늘도 이렇게 하나 배웠다. 월요일이 되면 바로 논의해봐야겠다. 수고 많았다 나 자신!

## 2023.02.06
오늘은 금요일에 고민했던 분개 관련 서비스와 관련해서 많은 사항들이 바뀌었다.
1. 연결 KEY 값 변화  
기존에는 기간손익 테이블에서 전표 ID와 분개 라인번호를 가지고 이를 통해 특정 분개의 데이터와 연결해서 값들을 가져왔었다. 근데 이게 정규화가 되지 않았다는 피드백을 받고 고민 끝에 분개 ID만 가지고 분개를 조회하도록 수정했다. 처음에 그렇게 하지 않았던 이유는, 기간손익의 특성 상 한 기수 이상의 기간에 걸쳐 처리될 수 있기 때문에 이력 테이블에서 관련 데이터를 서치해야한다. 이 때 이력 테이블을 어떻게 설정할지 나온 바가 없었고, 그나마 전표 이력 테이블에 대한 얘기가 나왔어서 전표 이력으로만 조회할 수 있다고 임시 가정했기 때문이었다. 이 부분에 대해 팀장님과 상의 끝에 분개 테이블과 바로 연결하는 방향으로 수정했다.  
2. 현황 조회 서비스  
위의 1번 이유로, 전표와 분개 테이블에서 일대다, 다대일 관계를 가지면서 기존의 JPQL과 QueryDSL은 사용할 수 없었다. 그 대신 native 쿼리를 사용해서 처리하고 이 데이터들을 하나씩 선언하면서 지정하는 방식으로 개발했었다. 그런데 이제 전표 데이터를 거치지 않고 연결되면서 연결구조에 문제가 사라졌고, 기본 JPQL로도 데이터를 충분히 가져올 수 있게 되었다. 그래서 쿼리 하나로 모두 처리하는 것이 아니라 서비스 중심으로 자바에서 코드로 만지는 방식으로 변화했다.  

2번의 코드는 관련 담당자에게 업무를 요청드렸고, 빠르게 해결되었다.  
이제 개별현황 데이터는 문제 없으니 이 분이 작성해주신 서비스를 바탕으로 전체 기간손익 조회 서비스를 위와 맞게 변경할 계획이다.  
전체 조회 서비스를 요청하지 않은 이유는 그래도 아직 내가 직접 만들고 배우고 싶기 때문이다.  
이제 내일 면밀히 살피면서 서비스를 새로 구성할 생각이다. 화이팅!!  

## 2023.02.07
우선 어제 요청한 서비스가 아직 머지되지 않아서 서비스 개발은 못했고, 각종 회의에 참석하면서 시간을 많이 뺏겼다.  
그러면서 오늘은 전체적으로 정리하는 시간을 가졌다.  
현재 개발중인 서비스의 우선순위가 밀리면서 개발이 급하지 않고, 다른 프로그램과 연결하면서 요청하고 기다리는 시간이 점점 많아지고 있다.  
이 여유 시간을 어떻게 쓸지에 대해 고민을 했다. 분류는 크게 두 가지다.  
  
1. 백엔드 개발 관련 공부
* DO IT! 자바 프로그래밍 입문 공부 마무리
* 초보 웹 개발자를 위한 스프링 5 프로그래밍 입문 책 공부 시작
2. 데이터 분석 및 엔지니어링 관련 공부
* 하둡 완벽 가이드 책 공부 시작

추가로 DB 공부를 먼저 할까도 생각했지만, 이전에 공부하면서 정리해둔 것이 있기 때문에 찬찬히 보면서 리마인드부터 할 예정이다.
이외에는 무엇을 먼저 할지, 구체적으로 일정을 어떻게 짤지는 아직 정하지 못했다. 우선은 하둡 관련해서 책을 사고, 관련 프로그래밍 툴들을 설치하려고 한다. 이것 만으로도 며칠은 소요될 것이다.  
데이터 엔지니어링 쪽은 사실 이 길을 갈지도 모르겠지만, 그래도 데이터 분석 쪽에 조금 미련이 남아서 후회하지 않을 만큼 공부하면서 차차 생각해보려고 한다. 화이팅!  

## 2023.02.13
오늘은 분개 관련 서비스를 위해 해당 테이블의 구조를 바꾸고 적용했다.  
이전에 말한 것 처럼, 전표ID와 분개라인번호 column을 삭제하고 분개ID를 추가했다.  
우선 기존에 작성된 java 코드에서 entity 부분을 수정하고 연결된 service에서도 간단히 반영해서 수정했다. 그리고 DB에서 기존 테이블을 drop하고 column의 변화를 반영해서 같은 이름의 새 테이블을 create했다.  
merge 요청을 날렸으니 이제 기다리고 있다.  
그러면서 내가 담당하고 있던 다른 테이블(PeriodBalance)에서 테이블과 변수 명을 변경해야해서 조금씩 수정중이다.  

## 2023.02.17
우선 PeriodBalance 테이블의 변수명 수정은 완료해서 merge 요청한 상태이다.  
그리고 이제 기간비용에 관해서 테이블 구조가 바뀌면서 코드들을 수정하고 있다.  
저번에 요청한 분개 정보 조회 서비스를 사용해서 개별 기간비용의 정보를 뽑아내는 코드를 작성했다. 서비스 부분은 조금만 쉬어도 감을 계속 잃는다. 오늘도 전에 개발한 코드를 보고 다시 이해하면서 짰다.  
그리고 dummy data가 없어서 기간비용전표를 새로 생성해서 넣으려고 하는데, 뭐 때문인지 잘 안된다..  
월요일에 맑은 정신으로 다시 봐야겠다. 힘내자!  

## 2023.02.20
오늘은 전체 기간비용 리스트를 조회서비스를 짜기 위해 고민을 했다.  
기간비용 테이블에서 분개 테이블로 타고 가서 계정과목 등의 테이블들과 join해서 정보를 가져와야 하는 상황이다. 여기서 문제는 기간비용 테이블을 분개 테이블과만 연결되어 있고, 분개 테이블에서 기간비용 id를 들고있지 않다는 것이다.  
기간비용 테이블에서 시작하면 문제가 없겠지만 그러면 모든 항목을 이중 join을 해서 가져와야 하는데, JPQL(또는 QueryDSL)로 이게 되는지 모르겠다.  
두 번째 방법으로는, 분개 테이블에서 기간비용 id를 제외한 모든 항목을 땡겨오고 service 단에서 기간비용리스트와 연결하는 것으로 생각했다. 이 방법의 문제는 in picList 를 사용하기 위해 PB 서비스를 짤 때 처럼 hashmap을 사용해야 한다는 것이다. 할수는 있겠지만 다른 방법을 더 찾아보고 싶다.  
내일 다른 팀원과 같이 논의해봐야겠다.  

## 2023.02.21
어제 고민하던 문제는 생각보다 간단하게 풀렸다!  
기간비용 테이블에서 이중 조인한 데이터를 가져올 수 있었다. 예를 들면 pci.journal.account.id 이런 식으로 분개, 계정과목 테이블을 타고 들어가서 계정과목의 데이터만 뽑을 수 있어서 이 방법을 사용했다.  
그리고 다시 개별 기간비용에서 분개 정보를 조회하는 서비스 부분으로 돌아왔다. 분개 부분은 담당 팀원이 서비스를 만들었지만, 기간비용의 시작일, 종료일 컬럼이 빠져있다. 이 두개는 사실 기간비용 테이블과 분개관리항목에서 중복으로 가지고 있다. 그래서 이부분은 나중에 기간비용 테이블과 join해서 가져오려고 했다. 그런데 지금 보니 Vo에 join을 하기보다는 어차피 다른 관리항목들도 가져오기 때문에 분개관리항목에서 가져오는 편이 더 깔끔하다고 생각했다.  
내일은 시작일, 종료일을 분개관리항목 테이블을 통해 추가로 가져오고, 기간손익 service에서 둘 사이의 일 수(number of day)를 계산하는 로직을 짜야겠다. 내일도 화이팅!  

## 2023.02.22
개별 기간비용에서 분개 정보 조회 부분은 개발을 마쳤다. 어제 계획한 시작일, 종료일 컬럼을 넣었고 추가로 일수유형코드와 일수 컬럼을 넣었다. 먼저 일수는 null로 넣은 뒤 기간비용서비스에서 계산하도록 구성했다. 그리고 일수유형코드는 일수를 계산할 때 양편넣기/초일산입/말일삽입인지에 따라 일수가 달라지기 때문에 필요했다. 기존에 name은 가져오지만, 더 정확하게 하기 위해 code를 가져와서 구분했다.  
일수 계산에서는 두 날짜 사이의 일 수를 계산하기 위해 다양한 함수를 검색해봤다. Calendar, Duration, Period 등의 함수들이 나왔다. Duration과 Period는 클래스를 추가로 만들어야 했던 반면 ChronoUnit은 클래스 추가 없이 계산이 가능했고, LocalDate 형식을 넣어도 총 일수 (ex.182일)가 나와서 편리했다. 다른 방법들은 year: 1, month: 3, days: 21 이런 식으로 나와서 한 번 더 계산하는 과정이 필요했다.  
내일은 현황 계산을 해야겠다! 생각보다 어려워서 이틀은 걸릴 것 같다. 화이팅!

## 2023.02.23
LocalDate 타입을 처음 다루는 것 치고는 생각보다 많이 짰다!  
많이 헤매기도 했지만 구글링에서 잘 정리된 블로그를 발견해서 수월해졌다. 지금 계산 로직은 거의 다 짰고, 예외처리 부분을 보강하고 있다. 다른 팀원분이 짜신 에러코드가 포함되어 있어서 돌려보지는 못하지만 빨간색이 뜨는 건 없으니 잘 돌아갈 거라 믿는다ㅎㅎ  
이제 내일은 코드를 마저 짜고 다른 팀원분의 코드도 취합해서 수정하고 돌려봐야겠다.  
LocalDate 타입은 내일 정리해야지
수고했다 내 자신!!  
